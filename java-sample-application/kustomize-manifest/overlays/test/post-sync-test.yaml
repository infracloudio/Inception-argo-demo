apiVersion: batch/v1
kind: Job
metadata:
   name: shopfront-test
   annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
   backoffLimit: 3
   template:
     spec:
       restartPolicy: OnFailure
       containers:
          - name: shopfront-status-check
            image: curlimages/curl
            command: ["/bin/sh","-c","[[ $(curl http://shopfront:8010/ -s -o /dev/null -w \"%{http_code}\") -eq 200 ]] && exit 0 || exit 1"]
---
apiVersion: batch/v1
kind: Job
metadata:
   name: productcatalogue-test
   annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/sync-wave: "1"
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
   backoffLimit: 3
   template:
     spec:
       restartPolicy: OnFailure
       containers:
          - name: productcatalogue-status-check
            image: curlimages/curl
            command: ["/bin/sh","-c","[[ $(curl http:/productcatalogue:8020/ -s -o /dev/null -w \"%{http_code}\") -eq 200 ]] && exit 0 || exit 1"]
